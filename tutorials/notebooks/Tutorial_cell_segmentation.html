<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Nuclei Segmentation by StarDist" />
<meta property="og:type" content="website" />
<meta property="og:url" content="tutorials/notebooks/Tutorial_cell_segmentation.html" />
<meta property="og:site_name" content="SMURF" />
<meta property="og:description" content="VisiumHD represents a revolutionary technology, potentially as impactful as the introduction of droplet-based single-cell methods. By eliminating gaps between spots, VisiumHD enables continuous and..." />
<meta property="og:image:width" content="1146" />
<meta property="og:image:height" content="600" />
<meta property="og:image" content="_images/social_previews/summary_tutorials_notebooks_Tutorial_cell_segmentation_04b69fee.png" />
<meta property="og:image:alt" content="VisiumHD represents a revolutionary technology, potentially as impactful as the introduction of droplet-based single-cell methods. By eliminating gaps between spots, VisiumHD enables continuous and..." />
<meta name="description" content="VisiumHD represents a revolutionary technology, potentially as impactful as the introduction of droplet-based single-cell methods. By eliminating gaps between spots, VisiumHD enables continuous and..." />
<meta name="twitter:card" content="summary_large_image" />
<link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html"><link rel="next" title="Data Structure" href="../../Data_structure/index.html"><link rel="prev" title="Unrolling Tutorial" href="unroll_example.html">

    <!-- Generated with Sphinx 8.1.3 and Furo 2025.09.25 -->
        <title>Nuclei Segmentation by StarDist - SMURF</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster.custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-shadow.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-punk.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-noir.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-light.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-borderless.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/micromodal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #003262;
  --color-brand-content: #003262;
  --admonition-font-size: var(--font-size-normal);
  --admonition-title-font-size: var(--font-size-normal);
  --code-font-size: var(--font-size--small);
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">SMURF</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">SMURF</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Tutorials</a><input aria-label="Toggle navigation of Tutorials" checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Tutorial_Mousebrian.html">Soft Segmentation Tutorial (Lite version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tutorial_Mousebrian_full.html">Soft Segmentation Tutorial (Full version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="unroll_example.html">Unrolling Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="unroll_example.html#Unrolling-Mouse-Brain-Data">Unrolling Mouse Brain Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="unroll_example.html#Unrolling-Mouse-Small-Intestine-Data">Unrolling Mouse Small Intestine Data</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Nuclei Segmentation by StarDist</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Data_structure/index.html">Data Structure</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">API</a><input aria-label="Toggle navigation of API" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/smurf.html">SMURF</a><input aria-label="Toggle navigation of SMURF" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.calculate_weight_to_celltype.html">smurf.calculate_weight_to_celltype</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.expanding_cells.html">smurf.expanding_cells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.get_finaldata.html">smurf.get_finaldata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.get_finaldata_fast.html">smurf.get_finaldata_fast</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.itering_arragement.html">smurf.itering_arragement</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.make_pixels_cells.html">smurf.make_pixels_cells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.make_preparation.html">smurf.make_preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.nuclei_rna.html">smurf.nuclei_rna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.plot_cellcluster_position.html">smurf.plot_cellcluster_position</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.plot_results.html">smurf.plot_results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.prepare_dataframe_image.html">smurf.prepare_dataframe_image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.return_celltype_plot.html">smurf.return_celltype_plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.singlecellanalysis.html">smurf.singlecellanalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.start_optimization.html">smurf.start_optimization</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/spatial_object.html">Spatial Object</a><input aria-label="Toggle navigation of Spatial Object" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.spatial_object.spatial_object.html">smurf.spatial_object.spatial_object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.spatial_object.spatial_object.add_segmentation.html">smurf.spatial_object.spatial_object.add_segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.spatial_object.spatial_object.generate_cell_spots_information.html">smurf.spatial_object.spatial_object.generate_cell_spots_information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/reference/smurf.spatial_object.spatial_object.image_temp.html">smurf.spatial_object.spatial_object.image_temp</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/The-Mitra-Lab/SMURF">GitHub</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/tutorials/notebooks/Tutorial_cell_segmentation.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="Nuclei-Segmentation-by-StarDist">
<h1>Nuclei Segmentation by <a class="reference external" href="https://qupath.readthedocs.io/en/0.3/docs/advanced/stardist.html">StarDist</a><a class="headerlink" href="#Nuclei-Segmentation-by-StarDist" title="Link to this heading">¶</a></h1>
<p>VisiumHD represents a revolutionary technology, potentially as impactful as the introduction of droplet-based single-cell methods. By eliminating gaps between spots, VisiumHD enables continuous and detailed tissue mapping, offering a subcellular resolution of 2µm. This resolution greatly improving the precision and accuracy of cellular reconstructions. As the technology is still in its early development stages, it is crucial to develop strategies that fully exploit the data it provides.</p>
<p>We introduce SMURF (Segmentation and Manifold UnRolling Framework) to leverage soft segmentation with VisiumHD data, facilitating the creation of a cells*genes <code class="docutils literal notranslate"><span class="pre">anndata</span></code> object. SMURF uses high-resolution images from VisiumHD for nuclei segmentation.</p>
<p>In our demonstration, we use <a class="reference external" href="https://qupath.readthedocs.io/en/0.3/docs/advanced/stardist.html">StarDist</a> for segmentation. Please install StarDist beforehand. Most segmentation tools rely on deep learning packages and require specific configurations. However, for this tutorial, there is no need to install any SMURF tools. We recommend users create a new environment specifically for segmentation. Researchers are encouraged to use their preferred segmentation methods. <strong>The segmentation
results should be saved as a 2D NumPy array with the same dimensions as the input image. In this array, regions without nuclei should be labeled as ``0``, while nucleated regions should be assigned ``unique cell IDs``.</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;smurf_example_data/&#39;</span>
<span class="n">save_path</span> <span class="o">=</span> <span class="s1">&#39;results_example_mousebrain/&#39;</span>
</pre></div>
</div>
</div>
<section id="Dataset-Information">
<h2>Dataset Information<a class="headerlink" href="#Dataset-Information" title="Link to this heading">¶</a></h2>
<p>Access the dataset here: <a class="reference external" href="https://www.10xgenomics.com/datasets/visium-hd-cytassist-gene-expression-libraries-of-mouse-brain-he">Visium HD CytAssist Gene Expression Libraries of Mouse Brain</a></p>
<p>Please input <code class="docutils literal notranslate"><span class="pre">image_to_segmentation.npy.gz</span></code> from the tutorial output.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s1">&#39;image_to_segmentation.npy.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Due to the large size of the image, we divide it into multiple parts. Here, the <code class="docutils literal notranslate"><span class="pre">loop</span></code> indicates the size of each segment. In other words, we will process the segmentation <code class="docutils literal notranslate"><span class="pre">loop</span></code> by <code class="docutils literal notranslate"><span class="pre">loop</span></code>, one segment at a time, with each neighboring segment overlapping by a <code class="docutils literal notranslate"><span class="pre">gap</span></code> size to facilitate correction.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i_max</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">j_max</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">loop</span> <span class="o">=</span> <span class="mi">4700</span>
<span class="n">segmentation_results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">gap</span> <span class="o">=</span> <span class="mi">80</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the StarDist 2D segmentation models.</span>
<span class="c1"># Import the recommended normalization technique for stardist.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">csbdeep.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">normalize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">stardist.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">StarDist2D</span>
<span class="c1"># Import squidpy and additional packages needed for this tutorial.</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">squidpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sq</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2024-11-30 09:34:34.115885: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2024-11-30 09:34:34.146737: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2024-11-30 09:34:34.146762: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2024-11-30 09:34:34.147672: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2024-11-30 09:34:34.152938: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-11-30 09:34:34.807242: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
_compat.py (124): The Shapely GEOS version (3.11.3-CAPI-1.17.3) is incompatible with the GEOS version PyGEOS was compiled with (3.10.4-CAPI-1.16.2). Conversions between both will be slow.
__init__.py (11): Geopandas was set to use PyGEOS, changing to shapely 2.0 with:

        geopandas.options.use_pygeos = True

If you intended to use PyGEOS, set the option to False.
utils.py (369): pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
utils.py (369): pandas.Float64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
utils.py (369): pandas.UInt64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;2D_versatile_he&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">stardist_2D_versatile_he</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prob_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># axis_norm = (0,1)   # normalize channels independently</span>
    <span class="n">axis_norm</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># normalize channels jointly</span>
    <span class="c1"># Make sure to normalize the input image beforehand or supply a normalizer to the prediction function.</span>
    <span class="c1"># this is the default normalizer noted in StarDist examples.</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">99.8</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis_norm</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;2D_versatile_he&quot;</span><span class="p">)</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_instances</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">nms_thresh</span><span class="o">=</span><span class="n">nms_thresh</span><span class="p">,</span> <span class="n">prob_thresh</span><span class="o">=</span><span class="n">prob_thresh</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2024-11-30 09:34:39.378100: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1929] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 22272 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:65:00.0, compute capability: 8.6
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<p>Since this HE image is contaminated, we have defined a function to clean the affected areas. <strong>There is no need to apply this function to your own image</strong>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

<span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="n">array_im</span><span class="p">):</span>
    <span class="n">target_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">155</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">126</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">128</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">101</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">190</span><span class="p">,</span><span class="mi">118</span><span class="p">,</span><span class="mi">172</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">220</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">176</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">139</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">110</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">132</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">102</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">136</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">108</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">125</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">110</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">109</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">91</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">178</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">144</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">149</span><span class="p">,</span><span class="mi">67</span><span class="p">,</span><span class="mi">122</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">191</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">159</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">186</span><span class="p">,</span><span class="mi">69</span><span class="p">,</span><span class="mi">150</span> <span class="p">],</span>
                              <span class="p">[</span><span class="mi">176</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">132</span> <span class="p">]]</span>
                            <span class="p">)</span>

    <span class="n">new_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">209</span><span class="p">]</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">for</span> <span class="n">target_color</span> <span class="ow">in</span> <span class="n">target_colors</span><span class="p">:</span>

        <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">array_im</span> <span class="o">-</span> <span class="n">target_color</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">array_im</span><span class="p">[</span><span class="n">distances</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_color</span>

    <span class="k">return</span> <span class="n">array_im</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2024-11-30 09:34:41.630608: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:454] Loaded cuDNN version 8904
2024-11-30 09:34:41.733600: I external/local_tsl/tsl/platform/default/subprocess.cc:304] Start cannot spawn child process: No such file or directory
2024-11-30 09:34:44.910268: I external/local_tsl/tsl/platform/default/subprocess.cc:304] Start cannot spawn child process: No such file or directory
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_11_2.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_11_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a_t</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">a_t</span><span class="p">)</span> <span class="c1"># No need to clean for your own data</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_12_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_12_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a_t</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">a_t</span><span class="p">)</span> <span class="c1"># No need to clean for your own data</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_13_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_13_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a_t</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">a_t</span><span class="p">)</span> <span class="c1"># No need to clean for your own data</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_14_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_14_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
WARNING:tensorflow:5 out of the last 5 calls to &lt;function Model.make_predict_function.&lt;locals&gt;.predict_function at 0x7fb049e43550&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_15_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_15_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
WARNING:tensorflow:6 out of the last 6 calls to &lt;function Model.make_predict_function.&lt;locals&gt;.predict_function at 0x7fb049ab14c0&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_16_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_16_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.0065</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_17_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_17_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a_t</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">a_t</span><span class="p">)</span> <span class="c1"># No need to clean for your own data</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_18_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_18_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_19_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_19_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_20_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_20_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_21_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_21_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_22_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_22_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>

<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_23_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_23_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>


<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_24_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_24_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>


<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_25_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_25_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>


<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_26_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_26_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">4</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">0</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>


<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_27_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_27_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">4</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">1</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>


<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_28_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_28_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">4</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">2</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>


<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_29_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_29_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">4</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">loop</span><span class="o">*</span><span class="mi">3</span>
<span class="n">a_t</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">ImageContainer</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">a_t</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">)</span>

<span class="n">sq</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="n">img</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
    <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">stardist_2D_versatile_he</span><span class="p">,</span>
    <span class="n">layer_added</span><span class="o">=</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">nms_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;H&amp;H&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;segmented_stardist&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>


<span class="n">segmentation_results</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;segmented_stardist&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_he&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.692478, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_30_1.png" src="../../_images/tutorials_notebooks_Tutorial_cell_segmentation_30_1.png" />
</div>
</div>
<p>Here, we have a function to combine all the smaller segments into the final complete image.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">segmentation_final</span><span class="p">(</span><span class="n">segmentation_results</span><span class="p">,</span> <span class="n">i_max</span><span class="p">,</span> <span class="n">j_max</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">gap</span><span class="p">):</span>

    <span class="c1"># Combine segmentation results from different blocks into a final segmentation map</span>
    <span class="n">segmentation_results1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Adjust labels to ensure uniqueness across blocks</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i_max</span><span class="p">,</span><span class="n">loop</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j_max</span><span class="p">,</span><span class="n">loop</span><span class="p">):</span>
            <span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">num</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">segmentation_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">i_max</span><span class="p">,</span> <span class="n">j_max</span><span class="p">))</span>

    <span class="c1"># Merge the blocks into the final segmentation map</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i_max</span><span class="p">,</span><span class="n">loop</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j_max</span><span class="p">,</span><span class="n">loop</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">segmentation_final</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="n">j</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span> <span class="o">=</span> <span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">segmentation_final</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="n">j</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span> <span class="o">=</span> <span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][:,</span><span class="n">gap</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">segmentation_final</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="n">j</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span> <span class="o">=</span> <span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][</span><span class="n">gap</span><span class="p">:,:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">segmentation_final</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="n">j</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span> <span class="o">=</span> <span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][</span><span class="n">gap</span><span class="p">:,</span><span class="n">gap</span><span class="p">:]</span>

    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Resolve overlaps between blocks</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i_max</span><span class="p">,</span><span class="n">loop</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j_max</span><span class="p">,</span><span class="n">loop</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,(</span><span class="n">j</span><span class="o">-</span><span class="n">loop</span><span class="p">))][:,</span><span class="o">-</span><span class="n">gap</span><span class="p">:])</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][:,:</span><span class="n">gap</span><span class="p">])</span>
                    <span class="n">uni_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="n">uni_a</span> <span class="o">=</span> <span class="n">uni_a</span><span class="p">[</span><span class="n">uni_a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">uni_a</span><span class="p">:</span>
                        <span class="n">uni_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">a</span> <span class="o">==</span> <span class="n">ele</span><span class="p">])</span>
                        <span class="n">uni_b</span> <span class="o">=</span> <span class="n">uni_b</span><span class="p">[</span><span class="n">uni_b</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>


                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uni_b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                            <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">==</span> <span class="n">ele</span><span class="p">]</span> <span class="o">=</span><span class="mi">0</span>
                            <span class="k">for</span> <span class="n">eleb</span> <span class="ow">in</span> <span class="n">uni_b</span><span class="p">:</span>
                                <span class="n">a</span><span class="p">[</span><span class="n">b</span> <span class="o">==</span> <span class="n">eleb</span><span class="p">]</span> <span class="o">=</span> <span class="n">eleb</span>

                    <span class="n">segmentation_final</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j_max</span><span class="p">)</span><span class="o">-</span><span class="n">gap</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,(</span><span class="n">j</span><span class="o">-</span><span class="n">loop</span><span class="p">))][</span><span class="n">gap</span><span class="p">:,</span><span class="o">-</span><span class="n">gap</span><span class="p">:])</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][</span><span class="n">gap</span><span class="p">:,:</span><span class="n">gap</span><span class="p">])</span>
                    <span class="n">uni_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="n">uni_a</span> <span class="o">=</span> <span class="n">uni_a</span><span class="p">[</span><span class="n">uni_a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">uni_a</span><span class="p">:</span>
                        <span class="n">uni_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">a</span> <span class="o">==</span> <span class="n">ele</span><span class="p">])</span>
                        <span class="n">uni_b</span> <span class="o">=</span> <span class="n">uni_b</span><span class="p">[</span><span class="n">uni_b</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uni_b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">t</span><span class="o">=</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">==</span> <span class="n">ele</span><span class="p">]</span> <span class="o">=</span><span class="mi">0</span>

                            <span class="k">for</span> <span class="n">eleb</span> <span class="ow">in</span> <span class="n">uni_b</span><span class="p">:</span>
                                <span class="n">a</span><span class="p">[</span><span class="n">b</span> <span class="o">==</span> <span class="n">eleb</span><span class="p">]</span> <span class="o">=</span> <span class="n">eleb</span>

                    <span class="n">segmentation_final</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j_max</span><span class="p">)</span><span class="o">-</span><span class="n">gap</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">i</span><span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results1</span><span class="p">[((</span><span class="n">i</span><span class="o">-</span><span class="n">loop</span><span class="p">),</span><span class="n">j</span><span class="p">)][</span><span class="o">-</span><span class="n">gap</span><span class="p">:,:])</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][:</span><span class="n">gap</span><span class="p">,:])</span>
                    <span class="n">uni_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:,:])</span>
                    <span class="n">uni_a</span> <span class="o">=</span> <span class="n">uni_a</span><span class="p">[</span><span class="n">uni_a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">uni_a</span><span class="p">:</span>
                        <span class="n">uni_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">a</span> <span class="o">==</span> <span class="n">ele</span><span class="p">])</span>
                        <span class="n">uni_b</span> <span class="o">=</span> <span class="n">uni_b</span><span class="p">[</span><span class="n">uni_b</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uni_b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">t</span><span class="o">=</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">==</span> <span class="n">ele</span><span class="p">]</span> <span class="o">=</span><span class="mi">0</span>
                            <span class="k">for</span> <span class="n">eleb</span> <span class="ow">in</span> <span class="n">uni_b</span><span class="p">:</span>
                                <span class="n">a</span><span class="p">[</span><span class="n">b</span> <span class="o">==</span> <span class="n">eleb</span><span class="p">]</span> <span class="o">=</span> <span class="n">eleb</span>


                    <span class="n">segmentation_final</span><span class="p">[(</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i_max</span><span class="p">)</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="n">j</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


                <span class="k">else</span><span class="p">:</span>

                    <span class="n">a</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results1</span><span class="p">[((</span><span class="n">i</span><span class="o">-</span><span class="n">loop</span><span class="p">),</span><span class="n">j</span><span class="p">)][</span><span class="o">-</span><span class="n">gap</span><span class="p">:,</span><span class="n">gap</span><span class="p">:])</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentation_results1</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)][:</span><span class="n">gap</span><span class="p">,</span><span class="n">gap</span><span class="p">:])</span>
                    <span class="n">uni_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:,:])</span>
                    <span class="n">uni_a</span> <span class="o">=</span> <span class="n">uni_a</span><span class="p">[</span><span class="n">uni_a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">uni_a</span><span class="p">:</span>
                        <span class="n">uni_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">a</span> <span class="o">==</span> <span class="n">ele</span><span class="p">])</span>
                        <span class="n">uni_b</span> <span class="o">=</span> <span class="n">uni_b</span><span class="p">[</span><span class="n">uni_b</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uni_b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">t</span><span class="o">=</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">==</span> <span class="n">ele</span><span class="p">]</span> <span class="o">=</span><span class="mi">0</span>
                            <span class="k">for</span> <span class="n">eleb</span> <span class="ow">in</span> <span class="n">uni_b</span><span class="p">:</span>
                                <span class="n">a</span><span class="p">[</span><span class="n">b</span> <span class="o">==</span> <span class="n">eleb</span><span class="p">]</span> <span class="o">=</span> <span class="n">eleb</span>


                    <span class="n">segmentation_final</span><span class="p">[(</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i_max</span><span class="p">)</span><span class="o">-</span><span class="n">gap</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i_max</span><span class="p">),</span><span class="n">j</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">loop</span><span class="p">,</span><span class="n">j_max</span><span class="p">)]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">segmentation_final</span>

<span class="n">segmentation_final</span> <span class="o">=</span> <span class="n">segmentation_final</span><span class="p">(</span><span class="n">segmentation_results</span><span class="p">,</span> <span class="n">i_max</span><span class="p">,</span> <span class="n">j_max</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">gap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Save result here.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s1">&#39;segmentation_final.npy&#39;</span><span class="p">,</span> <span class="n">segmentation_final</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../Data_structure/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Data Structure</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="unroll_example.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Unrolling Tutorial</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; Mitra Lab, Washington University in St. Louis
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Nuclei Segmentation by StarDist</a><ul>
<li><a class="reference internal" href="#Dataset-Information">Dataset Information</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=f5cff4aa"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/hoverxref.js"></script>
    <script src="../../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../../_static/js/micromodal.min.js"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>